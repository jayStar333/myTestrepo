import json
import tkinter as tk
from tkinter import messagebox
import os

# JSON file path
JSON_FILE = "data.json"

# Load existing data if available
def load_json():
    if os.path.exists(JSON_FILE):
        with open(JSON_FILE, "r") as f:
            try:
                return json.load(f)  # Load existing JSON data
            except json.JSONDecodeError:
                return {}  # Return empty if file is corrupt
    return {}  # Return empty if file doesn't exist

# Save updates to JSON file
def save_and_update():
    existing_data = load_json()  # Load current data

    # Get user input
    name = name_entry.get().strip()
    age = age_entry.get().strip()
    email = email_entry.get().strip()

    # Update only fields that are not empty
    if name:
        existing_data["name"] = name
    if age:
        try:
            existing_data["age"] = int(age)  # Ensure age is an integer
        except ValueError:
            messagebox.showerror("Error", "Age must be a number")
            return
    if email:
        existing_data["email"] = email

    # Save updated JSON back to file
    with open(JSON_FILE, "w") as f:
        json.dump(existing_data, f, indent=4)

    messagebox.showinfo("Success", "Data updated successfully!")

# GUI Setup
root = tk.Tk()
root.title("Update JSON Data")

# Load existing data into fields
data = load_json()

tk.Label(root, text="Name:").grid(row=0, column=0)
name_entry = tk.Entry(root)
name_entry.grid(row=0, column=1)
name_entry.insert(0, data.get("name", ""))  # Prefill with existing data

tk.Label(root, text="Age:").grid(row=1, column=0)
age_entry = tk.Entry(root)
age_entry.grid(row=1, column=1)
age_entry.insert(0, str(data.get("age", "")))  # Prefill

tk.Label(root, text="Email:").grid(row=2, column=0)
email_entry = tk.Entry(root)
email_entry.grid(row=2, column=1)
email_entry.insert(0, data.get("email", ""))  # Prefill

submit_button = tk.Button(root, text="Update JSON", command=save_and_update)
submit_button.grid(row=3, column=0, columnspan=2)

root.mainloop()
##################################
def update_multiple_dict_keys(main_key, updates):
    """Update multiple sub-keys within a dictionary inside a JSON key."""
    data = load_json()  # Load existing JSON data

    if main_key in data and isinstance(data[main_key], dict):
        # Update each sub-key specified in the 'updates' dictionary
        for sub_key, new_value in updates.items():
            data[main_key][sub_key] = new_value
    else:
        # If main_key doesn't exist or isn't a dict, create it
        data[main_key] = updates

    # Save updated JSON data
    with open(JSON_FILE, "w") as f:
        json.dump(data, f, indent=4)

    messagebox.showinfo("Success", "Contact info updated successfully!")
##################################
def save_and_update_contact():
    """Handles user input and updates multiple sub-keys in a dictionary inside JSON."""
    email_value = email_entry.get().strip()
    phone_value = phone_entry.get().strip()
    
    # Collect only non-empty values
    updates = {}
    if email_value:
        updates["email"] = email_value
    if phone_value:
        updates["phone"] = phone_value
    
    if not updates:
        messagebox.showerror("Error", "At least one field must be filled in.")
        return

    # Update the contact fields in JSON
    update_multiple_dict_keys("contact", updates)
##################################
def create_gui():
    """Create and display the Tkinter GUI for updating multiple dictionary values."""
    global root, email_entry, phone_entry

    root = tk.Tk()
    root.title("Update Contact Info")

    data = load_json()
    contact_data = data.get("contact", {})

    # Email input field
    tk.Label(root, text="New Email:").grid(row=0, column=0)
    email_entry = tk.Entry(root)
    email_entry.grid(row=0, column=1)

    # Phone input field
    tk.Label(root, text="New Phone:").grid(row=1, column=0)
    phone_entry = tk.Entry(root)
    phone_entry.grid(row=1, column=1)

    # Display existing contact info
    existing_contact_text = f"Email: {contact_data.get('email', 'N/A')}\nPhone: {contact_data.get('phone', 'N/A')}"
    tk.Label(root, text="Current Contact Info:").grid(row=2, column=0)
    tk.Label(root, text=existing_contact_text, fg="blue").grid(row=2, column=1)

    # Submit button
    submit_button = tk.Button(root, text="Update Contact", command=save_and_update_contact)
    submit_button.grid(row=3, column=0, columnspan=2)

    root.mainloop()